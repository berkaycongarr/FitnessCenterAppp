@model IEnumerable<FitnessApp.Entities.Randevu>

@{
    ViewData["Title"] = "Tüm Randevular";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2><i class="fa-solid fa-calendar-check text-warning"></i> Tüm Randevular</h2>
    <span class="badge bg-secondary fs-6">Toplam: @Model.Count()</span>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover shadow-sm align-middle">
        <thead class="bg-dark text-white">
            <tr>
                <th>Üye Adı</th>
                <th>Eğitmen</th>
                <th>Hizmet</th>
                <th>Tarih & Saat</th>
                <th>Durum</th>
                <th style="width: 200px;">İşlemler</th> </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr><td colspan="6" class="text-center">Sistemde kayıtlı randevu yok.</td></tr>
            }
            else
            {
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded-circle p-2 me-2">
                                    <i class="fa-solid fa-user text-primary"></i>
                                </div>
                                <div>
                                    <span class="fw-bold">@(item.User?.Username ?? "Silinmiş Üye")</span>
                                    <br>
                                    <small class="text-muted">@item.User?.Email</small>
                                </div>
                            </div>
                        </td>
                        <td>@(item.Antrenor?.Ad + " " + item.Antrenor?.Soyad)</td>
                        <td><span class="badge bg-info text-dark">@item.Hizmet?.Ad</span></td>
                        <td>
                            <div class="d-flex flex-column">
                                <span class="fw-bold">@item.TarihSaat.ToString("dd.MM.yyyy")</span>
                                <small class="text-muted">@item.TarihSaat.ToString("HH:mm")</small>
                            </div>
                        </td>
                        <td>
                            @if (item.Durum == 0)
                            {
                                <span class="badge bg-warning text-dark"><i class="fa-regular fa-clock"></i> Beklemede</span>
                            }
                            else if (item.Durum == 1)
                            {
                                <span class="badge bg-success"><i class="fa-solid fa-check"></i> Onaylandı</span>
                            }
                            else
                            {
                                <span class="badge bg-danger"><i class="fa-solid fa-xmark"></i> Reddedildi</span>
                            }
                        </td>
                        <td>
                            @if (item.Durum == 0) // Sadece 'Beklemede' ise butonları göster
                            {
                                <div class="btn-group" role="group">
                                    <a asp-action="RandevuOnayla" asp-route-id="@item.Id" class="btn btn-sm btn-success" title="Onayla">
                                        <i class="fa-solid fa-check"></i>
                                    </a>
                                    <a asp-action="RandevuReddet" asp-route-id="@item.Id" class="btn btn-sm btn-danger" title="Reddet"
                                       onclick="return confirm('Bu randevuyu reddetmek istediğinize emin misiniz?');">
                                        <i class="fa-solid fa-xmark"></i>
                                    </a>
                                </div>
                            }
                            else if (item.Durum == 1) // Onaylıysa sadece İptal butonu görünsün
                            {
                                <a asp-action="RandevuReddet" asp-route-id="@item.Id" class="btn btn-sm btn-outline-danger" title="İptal Et"
                                   onclick="return confirm('Onaylı randevuyu iptal etmek istediğinize emin misiniz?');">
                                    İptal Et
                                </a>
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<a asp-action="Index" class="btn btn-secondary mt-3">Admin Paneline Dön</a>